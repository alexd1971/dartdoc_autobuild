# Сервис автоматической генерации документации для пакетов на языке DART

Сервис генерирует документацию на основе github-репозиториев, способен обслуживать произвольное количество репозиториев. При этом после генерации документации автоматически формирует индекс для быстрого перехода к документации нужного пакета.

## Принцип работы сервиса

Сервис представляет собой github webhook и обслуживает события `push` и `pull_request` в репозиториях, настроенных на этот webhook

При получении запроса от github об изменениях в репозитории сервис обновляет соответствующий локальный репозиторий и генерирует документацию. После этого пересобирается индекс

Для получения доступа к документации необходимо настроить внешний web-сервер для статических страниц.

## Установка и запуск сервиса

Хотя существует возможность непосредственного запуска сервиса, но лучше всего сервис установить и запустить в docker-контейнере, так как сам сервис не подразумевает какого-либо конфигурирования. В частности без правок кода невозможно изменить директории для репозиториев и документации, а также порт, на котором слушает сервис. Все эти настройки возможно сделать при запуске в docker-контейнере. Поэтому будем рассматривать только запуск сервиса в docker-контейнере.

Команда для запуска:

`docker run --name dart_docs -v /path/to/repositories/dir:/app/repos -v /path/to/documentation/dir:/app/docs -p <port>:7777 alexd1971/dartdoc_autobuild`

`/path/to/repositories/dir` -- путь к директории, куда будут клонироваться и где поддерживаться в актуальном состоянии репозитории пакетов

`/path/to/documentation/dir` -- путь к директории, где будет формироваться документация по пакетам и индекс

`port` -- порт, на котором будет слушать webhook; этот порт может быть произвольным, главное, чтобы к нему было настроено проксирование извне. На этот порт будут отправляться запросы с github

##  Настройка

Для корректной работы сервиса на сервере, где запущен сервис необходимо настроить следующее:

1. Прокси пробрасывающий запросы на некий URL, например, `https://webhook.example.com` на `http://localhost:<port>`
2. Web-сервер, отдающий статические страницы из каталога `/path/to/documentation/dir`

## Подключение репозиториев к сервису

Для подлкючения репозитория к сервису необходимо зайти в настройки (`Settings`) репозитория на github. Далее переходим а раздел `Webhooks` и там создать новый webhook.

### Настройка webhook

* `Payload URL` настроенный URL для входящих запросов с github (`https://webhook.example.com`)
* `Content-Type` -- `application/json`
* Выбираем `Let me select individual events` и устанавливаем `Pushes` (выбрано по умполчанию) и `Pull requests`
* Нажимаем кнопку `Add webhook`

Дальше при каждом обновлении репозитория через `push` или `merge pull request` будет обновляться документация по пакету.